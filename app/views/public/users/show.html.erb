<div class="UShowPage">
    <div class="UShowPage__container">
        <section class="UShow">
            
            <div class="UShow__action__return">
                <%= link_to "<<戻る", root_path, class: "UShow__btn__return" %>
            </div>
            
            <div class="UShow__heading">
                <h2>会員詳細</h2>
            </div>
            
            <div class="UShow__contents">
                
                <div class="UShow__UserImage">
                    <%= attachment_image_tag @user, :image, :fill, 300, 300, fallback: "no_image.jpg",size: '300x300' %>
                    <% if @user != current_user %> 
                        <div class="UShow__relationship-<%= @user.id %>">
                            <%= render 'public/relationships/favorite', {user: @user} %>
                        </div>
                    <% end %>
                </div>
                
                <div class="UShow__table">
                    <table>
                        <tr>
                            <th class="UShow__thread"><span class="UShow__tag">登録日：</span></th>
                            <td class="UShow__date"><%= @user.created_at.strftime('%y年%m月%d日') %></td>
                        </tr>
                        <tr>
                            <th class="UShow__thread"><span class="UShow__tag">ニックネーム：</span></th>
                            <td class="UShow__date"><%= @user.nick_name %></td>
                        </tr>
                        <tr>
                            <th class="UShow__thread"><span class="UShow__tag">メールアドレス：</span></th>
                            <td class="UShow__date"><%= @user.email %></td>
                        </tr>
                        <tr>
                            <th class="UShow__thread"><span class="UShow__tag"></span></th>
                            <td class="UShow__date"></td>
                        </tr>
                    </table>
                </div>
                
            </div>
            <div>
            <div class="UShow__PageTabs">
                <%= link_to "favorite", user_favorite_books_path(@user), remote: true, class: "UShow__tab" %>
                <%= link_to "relationships", user_relationships_path(@user), remote: true, class: "UShow__tab--other" %>
            </div>
            </div>
            
            <!--<% if @favorite_books.present? %>-->
            <!--    <%= render 'public/users/book_favorites', favorite_books: @favorite_books %>-->

            <!--<% elsif @relationships.present? %>-->
            <!--    <%= render 'public/users/relationships', relationships: @relationships %>-->

            <!--<% end %>-->

            <div class="UShow__index">
                <div class="UShow__BookFavorites">
                <div class="UShow__page__heading">
                    <h2>お気に入りBook</h2>
                </div>
                <% if @favorite_books.blank? %>
                <div class="UShow__page__contents--other">
                    <h2> お気に入りされていません</h2>
                </div>
                <% else %>
                <div class="UShow__page__contents">
                    <% @favorite_books.each do |favorite_book| %>

                    <div class="UShow__favorite-book"> 
                    
                        <div class="UShow__book-image">
                            <div>
                                <%= link_to book_path(favorite_book.book_id), class: "UShow__BookLink" do %>
                                <%= attachment_image_tag favorite_book.book, :image, :fill, 200, 200, fallback: "no_image.jpg",size: '150x150' %>
                                <% end %>
                            </div>
                            <div class="UShow__average-rate-<%= favorite_book.id %>">
                                <% if favorite_book.book.reviews.blank? %>
                                    <% @average_rate = 0 %>
                                <% else %>
                                    <% @average_rate = favorite_book.book.reviews.average(:rate).round(1) %>
                                <% end %>
                                <script>
                                $('.UShow__average-rate-<%= favorite_book.id %>').empty();
                                $('.UShow__average-rate-<%= favorite_book.id %>').raty({
                                    starOff:  '<%= asset_path('star-off.png') %>',
                                    starOn : '<%= asset_path('star-on.png') %>',
                                    starHalf: '<%= asset_path('star-half.png') %>',
                                    half: true,
                                    readOnly: true,
                                    score: <%= @average_rate %>
                                });  
                                </script>
                            </div>
                        </div>
                        
                        <div class="UShow__book-data">
                             <table class="UShow__book-info">
                                <tr>
                                    <th class="UShow__thread--book"><span class="UShow__tag--book">タイトル</span></th>
                                    <td class="UShow__date--book"><%= favorite_book.book.name %></td>
                                </tr>
                                <tr>
                                    <th class="UShow__thread--book"><span class="UShow__tag--book">作者</span></th>
                                    <td class="UShow__date--book"><%= favorite_book.book.writer %></td>
                                </tr>
                                <tr>
                                    <th class="UShow__thread--book"><span class="UShow__tag--book">分類</span></th>
                                    <td class="UShow__date--book"><%= favorite_book.book.classification.name %></td>
                                </tr>
                                <tr>
                                    <th class="UShow__thread--book"><span class="UShow__tag--book">ジャンル</span></th>
                                    <td class="UShow__date--book"><%= favorite_book.book.genre.name %></td>
                                </tr>
                            </table>
                        </div>
                    </div> 
                    <% end %>
                </div>
                <% end %>
                </div>
            </div>
        </section>
    </div>
</div>

